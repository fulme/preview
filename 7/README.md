
# 申请晋级T7材料

> 陈虞付 2017-08-22
> 
> 负责TEG前端微聊、智能客服、多客服、神奇江湖、前端监控组件、小程序云、音视频通话、直播等项目，负责微聊、音视频通话、多客服、监控系统等项目的架构设计和实现，负责跟进TEG前端其他相关产品的质量、性能及安全工作，探索、普及并落地前沿技术，打造提升效率的工具集合。

## 58微聊项目
58微聊前端系统，是一套支持全平台、多账号体系的前端解决方案。目前已经接入房产、招聘、二手车、黄页等各大业务线，潜移默化中推动着58方方面面蓬勃发展。负责项目的整体规划、架构设计及重构，负责项目的质量提升、安全的防范，解决核心的疑难问题。撰写微聊核心逻辑（多页面消息同步）专利。

通过代码拆分及构建方案改进，完成了三端SDK的合并重构，实现三端按需打包，解决代码臃肿、修改不同步、重复劳动等的问题，web、wap版代码体积分别降低了**14%**和**19%**，项目维护成本显著降低。推动完成微信小程序的插件化升级，极大降低了代码的耦合和升级成本。

- 重构前
![](https://fulme.github.io/preview/7/im-pre.png)

- 重构后
![](https://fulme.github.io/preview/7/im-after.png)

采取有计划、分阶段地对微聊等项目进行针对性的性能优化。开发图片压缩工具，小图标压缩使得业务代码减少20K（10%），大图片压缩，减少117K（74%），异步延迟加载非核心代码122k（30%），页面实际加载速度提升**30%**左右，流量消耗降低**24.7%**。

## 前端监控系统
在接收微聊项目以后，时常有收到用户关于微聊使用异常的反馈，而用户的返回大多是通过运营人员转述的，信息不完整、有时候理解偏差比较大，问题难以复现和排查。基于此，开发了前端监控组件，并推动后端实现了管理后台。

监控任务看起来就是几个埋点，但其重要性却不容小觑。错误日志收集可以有效监控代码BUG，在大量用户反馈之前拿到错误现场，可以更快地解决问题，避免因为定位问题打扰用户；性能指标上报可以有效监控代码质量，是后续优化的基础和标杆；劫持信息上报可以有效把握网站安全现状，为后续的安全策略提供场景指导。

前端监控组件兼容所有平台和浏览器，目前已经在微聊、智能客服、多客服、passport主页完成接入。通过
性能指标制定了一系列的优化方案，微聊、智能客服项目加载性能提升了**30%**左右。多客服系统的加载速度更是接近秒开；通过错误日志解决了大量用户场景下的空指针报错及存储越界等问题。

![](https://fulme.github.io/preview/7/monitor.png)
上图是常规的问题解决流程，有了监控系统以后，定时看一下后台的错误日志就能解决绝大部分的问题，极大提升问题的解决速度。

-效果展示
![](https://fulme.github.io/preview/7/load.png)

## 多客服系统
随着分类信息业务进入线上化营销阶段，客服部门对意向客户的售前转化，售后服务有了新的需求，需要将低效的电话客服替换，转为在线客服从而大幅提高客服服务能力，包括更多的服务数量，更快更准的服务效率，以及更好的服务质量。

负责多客服系统前端的整体规划，负责客服工作台的架构及实现，完成1-5期的开发工作。主要包括文字、图片、表情的收发，以咨询和一对一单聊维度会话管理，通讯录及群发，咨询备注、转交，评价卡片的收发等功能。
![](https://fulme.github.io/preview/7/service-structure.png)

接入监控系统，追求极致的性能优化，运用图片压缩、非核心资源惰性加载，页面load时间1.2s左右，DOMContentLoad时间800ms左右，最近一天已经没有业务代码错误上报。

目前已经接入使用的客服有用户服务部-线上服务部、房产客服部-58组、房产客服部-安居客组、房产客服部-58用户端、房产客服部-安居客用户端等。每次咨询量50000+，发消息量60000+，收消息量4000+，客服人数90+。每日发送评价卡片4700+，评价个数1000+多，好评率63.12%。
- 客服部门概览
![](https://fulme.github.io/preview/7/kefu.png)
- 评价卡片概览
![](https://fulme.github.io/preview/7/evaluate.png)

## 58小程序云
小程序热度不减，各大厂商都推出了各自的小程序，目前已经上线的小程序包括：微信、百度、阿里、头条。58、安居客已经在百度小程序上线，这就引发了对TEG基础服务（包括passport、微聊等基础组件）的诉求，。如果每个平台都写一套代码，将会非常冗余，难以管理，如果使用其他的开发框架则有迁移成本及大量的未知问题。另外，微信已经提供了云函数服务，极大降低了小微产品开发成本及版本的快速迭代，但其他小程序平台并没有对应对的服务。

基于以上的痛点，启动了小程序云项目。主要分为四个部分：微信小程序转其他小程序、跨平台编译框架、云函数服务、运行时。
![](https://fulme.github.io/preview/7/yun.png)

### 微信小程序转其他小程序（wto-cli）
几乎不需要对已有的微信小程序做任何改动，可以接近零成本获得百度小城、阿里小程序、头条小程序。
目前，已经使用开发的工具将微聊微聊小程序转换完成并提供给安居客接入，已经将TEG的区块链应用神奇江湖项目转换成百度小程序，准备在百度上上线。
- 处理过程
![](https://fulme.github.io/preview/7/wto-cli.png)
- 效果展示
![](https://fulme.github.io/preview/7/wto-mg.png)

### 跨平台编译框架（wbmp）
基于开源的项目`wepy`进行改造、升级，实现百度、阿里、头条小程序的编译，并基于`weui`开发一套公用的UI组件库。目前，已经完成编译成百度小城的插件以及UI组件的封装，将`wepy`官网提供的三个demo全部编译成百度小程序并初步自测通过。
- H5编译器
![](https://fulme.github.io/preview/7/wepy-web-compiler.png)
- 小程序编译器
![](https://fulme.github.io/preview/7/wepy-app-compiler.png)
- 效果展示
![](https://fulme.github.io/preview/7/wbmp-demo.png)

### 云函数服务
提供类似于腾讯小程序.云开发的SDK，但支持所有的小程序平台。目前方案已经初步确定，待后端完成基础服务平台搭建后，前端接入小程序端的SDK开发并集成到跨平台编译框架中。
![](https://fulme.github.io/preview/7/faas.png)

## 其他
- 负责制定开发规范并制定常用开发工具（Websorm、sublime）的接入文档
- 负责神奇江湖、音视频通话、直播等项目的整体规划及架构设计
- 负责智能客服的代码规范及性能优化，加载速度提升30%左右
- 研究、探索区块链技术原理并部署实践，研究前端前沿技术并落地，在组内分享，提高团队的整体认知
- 发掘、处理TEG前端项目的性能、安全问题
- 发开提升效率的工具集合（图片压缩gulp插件、小程序资源升级gulp插件，日志分析浏览器插件等）

## 后续计划
- 58小程序云开发、完善、开源
- 微聊功能补齐，支持对外输出
- PC/M/小程序实时音视频通话完善，对外输出
- PC/M/小程序直播开发，对外输出
- 多客服系统持续迭代
- CSP、PWA等优化策略逐步落地

